CREATE DATABASE HTQLNH;

CREATE TABLE LUONG(
    LUONG_STT INT PRIMARY KEY,
    LUONG_LuongCS INT NOT NULL
);

CREATE TABLE CONG_VIEC(
    CV_STT INT PRIMARY KEY,
    CV_TenCV NVARCHAR(50) NOT NULL
);

CREATE TABLE NGAY_AP_DUNG_LUONG(
    LUONG_STT INT REFERENCES LUONG(LUONG_STT),
    CV_STT INT REFERENCES CONG_VIEC(CV_STT),
    NADL_NgayApDung DATETIME NOT NULL,
    PRIMARY KEY (LUONG_STT, CV_STT)
);

CREATE TABLE PHIEU_DAT_TIEC(
    PDT_MaPhieu CHAR(7) PRIMARY KEY,
    PDT_TenKH NVARCHAR(50) NOT NULL,
    PDT_SoDT CHAR(10) NOT NULL,
    PDT_ThoiDiemToChuc DATETIME NOT NULL,
    PDT_ThoiDiemDatCoc DATETIME NOT NULL,
    PDT_ThoiDiemThanhToan DATETIME
);

CREATE TABLE BANG_CHAM_CONG(
    PDT_MaPhieu CHAR(7) REFERENCES PHIEU_DAT_TIEC(PDT_MaPhieu),
    CV_STT INT REFERENCES CONG_VIEC(CV_STT),
    NV_MaNV CHAR(5) REFERENCES NHAN_VIEN(NV_MaNV),
    BCC_MucDoHoanThanh FLOAT NOT NULL,
    PRIMARY KEY (PDT_MaPhieu, CV_STT, NV_MaNV)
);

CREATE TABLE NHAN_VIEN(
    NV_MaNV CHAR(5) PRIMARY KEY,
    NV_HoTenNV NVARCHAR(50) NOT NULL,
    NV_NgaySinh DATETIME NOT NULL,
    NV_GioiTinh NVARCHAR(4) NOT NULL
);

CREATE TABLE CHI_TIET_PHIEU(
    PDT_MaPhieu CHAR(7) REFERENCES PHIEU_DAT_TIEC(PDT_MaPhieu),
    TD_MaTD CHAR(5) REFERENCES THUC_DON(TD_MaTD),
    CTP_SoLuong INT NOT NULL,
    PRIMARY KEY (PDT_MaPhieu, TD_MaTD)
);

CREATE TABLE NGAY_BAT_DAU_LAM(
    NV_MaNV CHAR(5) REFERENCES NHAN_VIEN(NV_MaNV),
    BP_MaBP CHAR(5) REFERENCES BO_PHAN(BP_MaBP),
    NBDL_NgayBatDauLam DATETIME NOT NULL,
    PRIMARY KEY (NV_MaNV, BP_MaBP)
);

CREATE TABLE BO_PHAN(
    BP_MaBP CHAR(5) PRIMARY KEY,
    BP_TenBP NVARCHAR(50) NOT NULL,
    BP_HeSoLuong FLOAT NOT NULL
);

CREATE TABLE THUC_DON(
    TD_MaTD CHAR(5) PRIMARY KEY,
    TD_TenTD NVARCHAR(50) NOT NULL,
    TD_MoTa NVARCHAR(1024)
);

CREATE TABLE CHI_TIET_THUC_DON(
    TD_MaTD CHAR(5) REFERENCES THUC_DON(TD_MaTD),
    MA_MaMA CHAR(5) REFERENCES MON_AN(MA_MaMA),
    CTTD_DonGia INT NOT NULL,
    CTTD_NgayApDung DATETIME NOT NULL,
    CTTD_SoLuong INT NOT NULL,
    PRIMARY KEY (TD_MaTD, MA_MaMA)
);

CREATE TABLE MON_AN(
    MA_MaMA CHAR(5) PRIMARY KEY,
    MA_TenMA NVARCHAR(50) NOT NULL,
    MA_DonViTinh NVARCHAR(50) NOT NULL
);

CREATE TABLE CHI_TIET_CONG_THUC(
    MA_MaMA CHAR(5) REFERENCES MON_AN(MA_MaMA),
    NL_MaNL CHAR(7) REFERENCES NGUYEN_LIEU(NL_MaNL),
    CTCT_SoLuong INT NOT NULL,
    CTCT_DonViTinh NVARCHAR(50),
    PRIMARY KEY (MA_MaMA, NL_MaNL)
);

CREATE TABLE NGUYEN_LIEU(
    NL_MaNL CHAR(7) PRIMARY KEY,
    NL_TenNL NVARCHAR(100) NOT NULL
);

CREATE TABLE TAI_KHOAN_NHAN_VIEN (
    TK_MaTK INT PRIMARY KEY IDENTITY(1,1),
    TK_TenDangNhap NVARCHAR(50) NOT NULL UNIQUE,
    TK_MatKhau NVARCHAR(50) NOT NULL,
    TK_Email NVARCHAR(100),
    TK_SoDienThoai NVARCHAR(20) NOT NULL UNIQUE,
    NV_MaNV CHAR(5) REFERENCES NHAN_VIEN(NV_MaNV),
    TK_NgayTao DATETIME DEFAULT GETDATE()
);

CREATE TABLE TAI_KHOAN_KHACH_HANG (
    TK_MaTK INT PRIMARY KEY IDENTITY(1,1),
    TK_TenDangNhap NVARCHAR(50) NOT NULL UNIQUE,
    TK_MatKhau NVARCHAR(50) NOT NULL,
    TK_Email NVARCHAR(100),
    TK_SoDienThoai NVARCHAR(20) NOT NULL UNIQUE,
    PDT_MaPhieu CHAR(7) REFERENCES PHIEU_DAT_TIEC(PDT_MaPhieu),
    TK_NgayTao DATETIME DEFAULT GETDATE()
);
